<!DOCTYPE html>
<html>
<head>
    <title>WebAssembly Memory64 & Multi-Memory Test</title>
    <style>
        body { font-family: monospace; margin: 20px; }
        .test-section { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button { margin: 5px; padding: 10px; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üß™ WebAssembly Memory64 & Multi-Memory Test</h1>
    
    <div class="test-section">
        <h2>üìù Feature Detection</h2>
        <button onclick="testFeatures()">Detect WASM Features</button>
        <button onclick="testMemory64Support()">Test Memory64 Support</button>
        <button onclick="testMultiMemorySupport()">Test Multi-Memory Support</button>
        <pre id="features-output"></pre>
    </div>

    <div class="test-section">
        <h2>üìù Basic Memory Allocation</h2>
        <button onclick="testBasicAllocation(1)">Allocate 1 MB</button>
        <button onclick="testBasicAllocation(10)">Allocate 10 MB</button>
        <button onclick="testBasicAllocation(100)">Allocate 100 MB</button>
        <button onclick="testBasicAllocation(1000)">Allocate 1 GB</button>
        <button onclick="testBasicAllocation(2000)">Allocate 2 GB</button>
        <button onclick="testBasicAllocation(3000)">Allocate 3 GB</button>
        <button onclick="testBasicAllocation(4000)">Allocate 4 GB</button>
        <button onclick="testBasicAllocation(5000)">Allocate 5 GB</button>
        <pre id="basic-output"></pre>
    </div>

    <div class="test-section">
        <h2>üìù Memory64 Allocation (>4GB)</h2>
        <button onclick="testMemory64Allocation(5000)">Allocate 5 GB</button>
        <button onclick="testMemory64Allocation(8000)">Allocate 8 GB</button>
        <button onclick="testMemory64Allocation(10000)">Allocate 10 GB</button>
        <pre id="memory64-output"></pre>
    </div>

    <div class="test-section">
        <h2>üìù Multi-Memory Allocation</h2>
        <button onclick="testMultiMemory('weights', 100)">Weights: 100 MB</button>
        <button onclick="testMultiMemory('activations', 50)">Activations: 50 MB</button>
        <button onclick="testMultiMemory('kv_cache', 200)">KV Cache: 200 MB</button>
        <button onclick="testMultiMemory('embeddings', 75)">Embeddings: 75 MB</button>
        <pre id="multi-memory-output"></pre>
    </div>

    <div class="test-section">
        <h2>üìù Stress Test</h2>
        <button onclick="runStressTest()">Run Progressive Stress Test</button>
        <button onclick="testWasmMemoryGrow()">Test WASM Memory.grow()</button>
        <button onclick="getMemoryStats()">Get Memory Stats</button>
        <pre id="stress-output"></pre>
    </div>

    <script type="module">
        import init, { 
            WasmMemoryTest, 
            test_memory64_support, 
            test_multi_memory_support, 
            detect_wasm_features 
        } from './pkg/wasm_memory64_multi_test.js';

        let wasmTest;

        async function initWasm() {
            try {
                await init();
                wasmTest = new WasmMemoryTest();
                console.log('‚úÖ WebAssembly module loaded successfully');
            } catch (error) {
                console.error('‚ùå Failed to load WebAssembly module:', error);
                document.getElementById('features-output').textContent = 
                    '‚ùå Failed to load WebAssembly module: ' + error;
            }
        }

        window.testFeatures = function() {
            try {
                const features = detect_wasm_features();
                document.getElementById('features-output').textContent = features;
            } catch (error) {
                document.getElementById('features-output').textContent = '‚ùå Error: ' + error;
            }
        };

        window.testMemory64Support = function() {
            try {
                const support = test_memory64_support();
                document.getElementById('features-output').textContent = support;
            } catch (error) {
                document.getElementById('features-output').textContent = '‚ùå Error: ' + error;
            }
        };

        window.testMultiMemorySupport = function() {
            try {
                const support = test_multi_memory_support();
                document.getElementById('features-output').textContent = support;
            } catch (error) {
                document.getElementById('features-output').textContent = '‚ùå Error: ' + error;
            }
        };

        window.testBasicAllocation = function(sizeMB) {
            try {
                const result = wasmTest.test_basic_allocation(sizeMB);
                document.getElementById('basic-output').textContent = result;
            } catch (error) {
                document.getElementById('basic-output').textContent = '‚ùå Error: ' + error;
            }
        };

        window.testMemory64Allocation = function(sizeMB) {
            try {
                const result = wasmTest.test_memory64_allocation(sizeMB);
                document.getElementById('memory64-output').textContent = result;
            } catch (error) {
                document.getElementById('memory64-output').textContent = '‚ùå Error: ' + error;
            }
        };

        window.testMultiMemory = function(region, sizeMB) {
            try {
                const result = wasmTest.test_multi_memory_allocation(region, sizeMB);
                document.getElementById('multi-memory-output').textContent = result;
            } catch (error) {
                document.getElementById('multi-memory-output').textContent = '‚ùå Error: ' + error;
            }
        };

        window.runStressTest = function() {
            try {
                const result = wasmTest.stress_test();
                document.getElementById('stress-output').textContent = result;
            } catch (error) {
                document.getElementById('stress-output').textContent = '‚ùå Error: ' + error;
            }
        };

        window.testWasmMemoryGrow = function() {
            try {
                const result = wasmTest.test_wasm_memory_grow();
                document.getElementById('stress-output').textContent = result;
            } catch (error) {
                document.getElementById('stress-output').textContent = '‚ùå Error: ' + error;
            }
        };

        window.getMemoryStats = function() {
            try {
                const stats = wasmTest.get_memory_stats();
                document.getElementById('stress-output').textContent = stats;
            } catch (error) {
                document.getElementById('stress-output').textContent = '‚ùå Error: ' + error;
            }
        };

        // Initialize WASM when page loads
        initWasm();
    </script>
</body>
</html>
